"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PrecachePanoramaAssetsPlugin = void 0;
const tslib_1 = require("tslib");
const html_webpack_plugin_1 = tslib_1.__importDefault(require("html-webpack-plugin"));
const url_1 = require("url");
class PrecachePanoramaAssetsPlugin {
    constructor({ filter = /\.(png|je?pg)$/ } = {}) {
        this.filter = filter;
    }
    apply(compiler) {
        compiler.hooks.compilation.tap(this.constructor.name, (compilation) => {
            var _a;
            const publicPath = compilation.getPath((_a = compilation.outputOptions.publicPath) !== null && _a !== void 0 ? _a : '');
            const htmlHooks = html_webpack_plugin_1.default.getHooks(compilation);
            htmlHooks.beforeEmit.tap(this.constructor.name, (args) => {
                const assetUrls = Object.keys(compilation.assets)
                    .filter((assetName) => this.filter.test(assetName))
                    .map((assetName) => new url_1.URL(assetName, publicPath).toString());
                if (assetUrls.length > 0) {
                    args.html = `<!--\n${assetUrls.map((x) => `"${x}"`).join('\n')}\n-->\n${args.html}`;
                }
                return args;
            });
        });
    }
}
exports.PrecachePanoramaAssetsPlugin = PrecachePanoramaAssetsPlugin;
//# sourceMappingURL=precache-assets.js.map